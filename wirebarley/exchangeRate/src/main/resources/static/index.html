<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>환율계산서비스</title>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet"
          href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
          integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
          crossorigin="anonymous">
</head>
<body>
<div class="col-md-12">
    <h1>환율 계산</h1>
    <div>
        송금국가 : {{base.name}}({{base.currencyUnit}})
    </div>
    <div>
        수취국가 :
        <select name="quotes" id="quotes">
            <option value="">국가를 선택해주세요</option>
            {{#quotes}}
            <option value="{{value}}">{{name}}({{currencyUnit}})</option>
            {{/quotes}}
        </select>
    </div>
    <div>
        환율 : <span id="rate"></span>
    </div>
    <div>
        송금액 : <input type="text" id="remittance" name="Remittance"/> {{base.currencyUnit}}
    </div>
    <div class="submit-button" style="margin: 5px 0px;">
        <button class="btn btn-primary" type="button" id="submitBtn" name="submitBtn" disabled="true">
            Submit
        </button>
    </div>
    <div>
        <span id="amount"></span>
    </div>
</div>
<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
<script>
    $('#quotes').change(function () {
        const base = '{{base.value}}';
        const quotes = $('#quotes option:selected').val();

        if (quotes === "") {
            $('#submitBtn').prop('disabled', true);
            $('#rate').text('');
            return false;
        }

        $.ajax({
            url: '/rate?base=' + base + '&quotes=' + quotes,
            success: function (data) {
                console.log(data);
                $('#submitBtn').prop('disabled', false);
                const rate = numberWithCommas(data.rate);
                const currency = data.quotedCurrency + '/' + data.baseCurrency;
                $('#rate').text(rate + ' ' + currency);
            }
        })
    })

    $('#submitBtn').click(function () {
        const base = '{{base.value}}';
        const quotes = $('#quotes option:selected').val();
        const remittance = $('#remittance').val();

        if (!$.isNumeric(remittance)) {
            $('#amount').css('color', 'red');
            $('#amount').text("송금액이 바르지 않습니다.");
            return false;
        }

        $.ajax({
            url: '/amount?base=' + base + '&quotes=' + quotes + '&remittance=' + remittance,
            success: function (data) {
                console.log(data)
                const exchangeRate = data.exchangeRate;
                const amount = numberWithCommas(data.amount.value);
                $('#amount').css('color', 'black');
                $('#amount').text(
                    '수취금액은 '
                    + amount
                    + ' '
                    + exchangeRate.quotedCurrency
                    + ' 입니다.'
                );
            },
            error: function (error) {
                $('#amount').css('color', 'red');
                $('#amount').text(error.responseText);
            }
        })
    })

    function numberWithCommas(n) {
        const num = n.toFixed(2);
        return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }

</script>
</body>
</html>